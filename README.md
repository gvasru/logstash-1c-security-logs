# Пример настроек для logstash для импорта логов 1с в формате lgf
Описание формата лога 1с: 
https://infostart.ru/1c/articles/182061/
https://infostart.ru/public/182820/

# Настройка
Файлы логов 1с находятся в папке srvinfo\reg_1541\<идентификатор базы> 
Какой идентификатор принадлежит какой базе можно посмотреть в файле 1CV8Clst.lst
В файле конфига logstash заполните:

path => ["srvinfo\reg_1541\<идентификатор базы>\*.lgp"]
start_position => "beginning"
type => "имяБД"
    
# Справочники
Файлы журнала регистрации 1с делятся на 2 части: сам журнал регистрации и "словать" данных. 
Поэтому перед экспортом журнала регистрации нужно создать словари для этих данных. 

Для этого используются скрипты lgf-to-yml.ps1 или lgf-to-yml.sh
Перед запуском измените путь к файлам в зависимости от идентификатора базы:
conf.d/custom_mapping_1C/DB_NAME_UserId.yml

# Формат файла lgp:
0) Дата и время в формате "yyyyMMddHHmmss"
1) Статус транзакции – может принимать четыре значения "N" – "Отсутствует", "U" – "Зафиксирована", "R" – "Не завершена" и "C" – "Отменена";
2) Транзакция в формате записи из двух элементов преобразованных в шестнадцатеричное число – первый – число секунд с 01.01.0001 00:00:00 умноженное на 10000, второй – номер транзакции;
3) Пользователь – указывается номер в массиве пользователей (парсится из справочников - файлы DB_NAME_UserId и DB_NAME_UserDescr)
4) Компьютер – указывается номер в массиве компьютеров (парсится из справочников - файл DB_NAME_ComputerId)
5) Приложение – указывается номер в массиве приложений (парсится из справочников - файл DB_NAME_Applications)
6) Соединение – номер соединения (парсится из справочников - файл DB_NAME_Applications)
7) Событие – указывается номер в массиве событий (парсится из справочников - файл DB_NAME_EventId)
8) Важность – может принимать четыре значения – "I" – "Информация", "E" – "Ошибки","W" – "Предупреждения" и "N" – "Примечания";
9) Комментарий – любой текст в кавычках;
10) Метаданные – указывается номер в массиве метаданных (парсится из справочников - файл DB_NAME_MetadataId)
11) 
12) Данные – самый хитрый элемент, содержащий вложенную запись. (TODO Заполнить расшифровку)
13) Представление данных;
14) ?
15) ?
16) ?
17) ?
18) Сервер – указывается номер в массиве серверов (парсится из справочников - файл DB_NAME_WorkServerId)
19) ?
20) ?
21) ?


# Форк. Оригинальное описание
https://xdd.silverbulleters.org/t/bigdata-logmanager-dlya-1s/62/140

https://xdd.silverbulleters.org/t/bigdata-logmanager-dlya-1s/62/143
